# PSearch - 3D ligand-based pharmacophore modeling

PSearch is a tool to generate 3D ligand-based pharmacophore models and perform virtual screening with them.

## Installation

```bash
pip install -U git+https://github.com/meddwl/psearch.git
```

## Dependency

`rdkit >= 2017.09`  
`networkx >= 2`  
[pmapper >= 0.4.0](https://github.com/DrrDom/pmapper)  

## Example
The demonstration of the tool is carried out on the example of the target ChEMBL5719. A shortened sample of 233 structures is proposed.

### Creation of ligand-based pharmacophore models
It is recommended to create an empty dir which would be your `$PROJECT_DIR` and copy an input file to that location.
In our case, PROJECT_DIR=example/test.
There are two steps of pharmacophore model generation.

1. Generation of a database with precomputed conformers and pharmacophores. 

```python
gen_db -i $PROJECT_DIR/chembl5719_example.smi -o $PROJECT_DIR/data/chembl5719_example.dat -c 4
```
`-i` - path to the input SMILES file  
`-o` - path to database (should have extension .dat)  
`-c` - number of CPUs to use  
There are other arguments which one can tune. Invoke script with `-h` key to get full information.
Generating the database on 4 cores will take up to 15 minutes  

The script takes as input a tab-separated SMILES file containing `SMILES`, `compound id`, `activity` columns. 
The third column should contain a number `1` or `0`. If there are bad structures in the input. smi file, a new file will be created without these structures. The original input file would be backed up.
The script generates stereoisomers and conformers, creates the database of compounds with labeled pharmacophore features.  

2. Model building.  

```python
psearch -p $PROJECT_DIR/pharm/ -i $PROJECT_DIR/chembl5719_example.smi -d $PROJECT_DIR/data/chembl5719_example.dat -c 4
```
`-p` - path to the models directory where training set files, pharmacophore models, screening results and external model statistics will be stored  
`-i` - path to the input SMILES file  
`-d` - path to the database generated on the previous step  
`-c`- number of CPUs to use  

Other arguments are available at the command line.

This will create several dirs within `pharm`. `models` contains generated pharmacophore models. File names use the following naming convention: t<train_set_number>_f<number_of_features>_p<sequentional_model_number>.pma. `results` contains a file with validation statistics (molecules which were not used to train particular models are used as corresponding test sets). `screen` contains results of screening of test set compounds. `trainset` contains training sets. `files` contain intermediate files generated by the program.  

You will receive a progress notification:
```train set t2: 2 models (49.371s)
train set t1: 17 models (53.925s)
train set t3: 3 models (73.206s)
train set centroids: 1 models (33.862s)
train set t0: 7 models (107.158s)
train set t4: 21 models (99.114s)
external_statistics.txt: (0.535s)```

### Virtual screening with pharmacophore models 

1. Database creation using the same procedure as described above. 
* To save time, we will not generate a new database for virtual screening as part of this example

2. Virtual screening.
  
```python
screen_db -d $PROJECT_DIR/data/chembl5719_example.dat -q $PROJECT_DIR/pharm/models/ -o $PROJECT_DIR/vs -c 4
```
`-d` - input generated database  
`-q` - pharmacophore model or models or a directory with models. If a directory would be specified all pma- and xyz-files will be recognized as pharmacophores and will be used for screening  
`-o` - path to an output directory if multiple models were supplied for screening or a path to a text/sdf file  
`-c`- number of CPUs to use  

If multiple models are used for screening and sdf output is desired a user should add `-z` argument which will force output format to be sdf.

3. Calculating probability of the activity of molecules towards the considering protein by precision of the molecules.  
The scheme of how the probability is calculated is described in the [article](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7024325/) below

```python
prediction -vs $PROJECT_DIR/vs -stat $PROJECT_DIR/pharm/results/external_statistics.txt -o $PROJECT_DIR/prediction-ranked_mols.txt
```
`-vs` - path to the virtual screening result  
`-stat` - file with the calculated precision of pharmacophore models  
`-o` - output text file where will be saved the prediction  

## Documentation

All scripts have `-h` argument to retrieve descriptions of all available options and arguments.

## Authors
Alina Kutlushina, Pavel Polishchuk

## Citation
Ligand-Based Pharmacophore Modeling Using Novel 3D Pharmacophore Signatures  
Alina Kutlushina, Aigul Khakimova, Timur Madzhidov, Pavel Polishchuk  
*Molecules* **2018**, 23(12), 3094  
https://doi.org/10.3390/molecules23123094

Probabilistic Approach for Virtual Screening Based on Multiple Pharmacophores
Timur Madzhidov, Assima Rakhimbekova, Alina Kutlushuna, Pavel Polishchuk
*Molecules* **2020**, 25(2), 385  
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7024325/

## License
BSD-3 clause
